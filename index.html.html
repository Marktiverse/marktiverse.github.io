<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥æ¥­ç¸¾å ±å‘Šç”Ÿæˆå™¨</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¨­å®šå­—é«”ç‚º Interï¼Œç¢ºä¿ä¸­æ–‡å­—é«”é¡¯ç¤ºæ¸…æ™° */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* éš±è—é è¨­çš„æ•¸å­—è¼¸å…¥æ¬„ä½ç®­é ­ */
        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type='number'] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-50 p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 md:p-10 border border-blue-100">
        <h1 class="text-3xl font-extrabold text-blue-700 mb-6 text-center">
            ğŸ“ å°åŒ—ä¸‰å€æ¯æ—¥é€Ÿé€Ÿå›å ± <!-- æ¨™é¡Œå·²æ›´æ–° -->
        </h1>
        <p class="text-gray-500 mb-8 text-center">
            è«‹è¼¸å…¥æ‰€æœ‰ç›¸é—œæ•¸æ“šï¼Œä¸¦é»æ“Šã€Œç”Ÿæˆå ±å‘Šã€ä»¥ç²å–æ¨™æº–æ ¼å¼æ–‡å­—ã€‚
        </p>

        <!-- è¡¨å–®å®¹å™¨ -->
        <form id="reportForm" class="space-y-8">

            <!-- åŸºç¤è³‡è¨Š -->
            <div class="p-6 bg-blue-50 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold text-blue-600 mb-4 border-b pb-2">åŸºæœ¬è³‡è¨Š</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="reportDate" class="block text-sm font-medium text-gray-700 mb-1">æ—¥æœŸ (YYYY-MM-DD)</label>
                        <input type="date" id="reportDate" required class="w-full p-3 border border-blue-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                    </div>
                    <div>
                        <label for="userName" class="block text-sm font-medium text-gray-700 mb-1">å§“å</label>
                        <input type="text" id="userName" placeholder="è«‹è¼¸å…¥å§“å" required class="w-full p-3 border border-blue-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                    </div>
                </div>
            </div>

            <!-- ä»Šæ—¥æ´»å‹•èˆ‡æˆæœ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- ä»Šæ—¥å¤–æ’¥ -->
                <div class="p-6 bg-yellow-50 rounded-lg shadow-md col-span-1">
                    <h2 class="text-xl font-semibold text-yellow-700 mb-4 border-b pb-2">ä»Šæ—¥å¤–æ’¥é€šæ•¸</h2>
                    <div class="space-y-4">
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">æ½›å®¢ (æ–°æ¡ˆ)</span>
                            <input type="number" id="callsPotential" value="0" min="0" required class="mt-1 w-full p-3 border border-yellow-300 rounded-lg">
                        </label>
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">éä¿ (èˆŠå®¢)</span>
                            <input type="number" id="callsExpired" value="0" min="0" required class="mt-1 w-full p-3 border border-yellow-300 rounded-lg">
                        </label>
                    </div>
                </div>

                <!-- ä»Šæ—¥é ç´„èˆ‡åˆ°åº— -->
                <div class="p-6 bg-green-50 rounded-lg shadow-md col-span-2">
                    <h2 class="text-xl font-semibold text-green-700 mb-4 border-b pb-2">ä»Šæ—¥æ´»å‹•æ¦‚æ³</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="block col-span-1">
                            <span class="text-sm font-medium text-gray-700">ä»Šæ—¥é ç´„ (ç¸½è¨ˆ)</span>
                            <input type="number" id="appointmentsToday" value="0" min="0" required class="mt-1 w-full p-3 border border-green-300 rounded-lg">
                        </label>
                        <label class="block col-span-1">
                            <span class="text-sm font-medium text-gray-700">åˆ°åº—ç¸½äººæ•¸</span>
                            <input type="number" id="storeVisitsTotal" value="0" min="0" required class="mt-1 w-full p-3 border border-green-300 rounded-lg">
                        </label>
                        <!-- åˆ°åº—ç´°é … (éš±è—å¼ï¼Œé€é JS æª¢æŸ¥ç¸½äººæ•¸ä¾†æ§åˆ¶è¦–è¦º) -->
                        <div class="col-span-3 grid grid-cols-3 gap-4 pt-2">
                            <label class="block">
                                <span class="text-xs font-medium text-gray-500">åˆ°åº—-éä¿</span>
                                <input type="number" id="visitsExpired" value="0" min="0" required class="mt-1 w-full p-3 border border-green-300 rounded-lg text-sm">
                            </label>
                            <label class="block">
                                <span class="text-xs font-medium text-gray-500">åˆ°åº—-ä¿å…§</span>
                                <input type="number" id="visitsInWarranty" value="0" min="0" required class="mt-1 w-full p-3 border border-green-300 rounded-lg text-sm">
                            </label>
                            <label class="block">
                                <span class="text-xs font-medium text-gray-500">åˆ°åº—-æ–°å®¢</span>
                            <input type="number" id="visitsNewCustomer" value="0" min="0" required class="mt-1 w-full p-3 border border-green-300 rounded-lg text-sm">
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è©¦ç”¨èˆ‡æˆäº¤ -->
            <div class="p-6 bg-red-50 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-red-700 mb-4 border-b pb-2">è©¦ç”¨èˆ‡æˆäº¤çµæœ</h2>
                <div class="grid grid-cols-2 gap-4 md:grid-cols-4">
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">è©¦ç”¨ HA</span>
                        <input type="number" id="trialHA" value="0" min="0" required class="mt-1 w-full p-3 border border-red-300 rounded-lg">
                    </label>
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">è©¦ç”¨ APAP</span>
                        <input type="number" id="trialAPAP" value="0" min="0" required class="mt-1 w-full p-3 border border-red-300 rounded-lg">
                    </label>
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">æˆäº¤ HA</span>
                        <input type="number" id="dealHA" value="0" min="0" required class="mt-1 w-full p-3 border border-red-300 rounded-lg">
                    </label>
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">æˆäº¤ APAP</span>
                        <input type="number" id="dealAPAP" value="0" min="0" required class="mt-1 w-full p-3 border border-red-300 rounded-lg">
                    </label>
                </div>
            </div>

            <!-- æœˆåº¦é€²åº¦ -->
            <div class="p-6 bg-purple-50 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-purple-700 mb-4 border-b pb-2">ç•¶æœˆè©¦è½é€²åº¦</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">ç›®æ¨™äººæ•¸ (ä½)</span>
                        <input type="number" id="monthlyTarget" value="0" min="0" required class="mt-1 w-full p-3 border border-purple-300 rounded-lg">
                    </label>
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">ç›®å‰ç´¯è¨ˆäººæ•¸ (ä½)</span>
                        <input type="number" id="monthlyCumulative" value="0" min="0" required class="mt-1 w-full p-3 border border-purple-300 rounded-lg">
                    </label>
                </div>
            </div>

            <!-- æ˜æ—¥è¨ˆç•« -->
            <div class="p-6 bg-indigo-50 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-indigo-700 mb-4 border-b pb-2">æ˜æ—¥è¨ˆç•«</h2>
                <div class="space-y-6">
                    <!-- æ˜æ—¥é ç´„ç´°é … -->
                    <div class="grid grid-cols-2 gap-4 md:grid-cols-4">
                        <label class="block col-span-2 md:col-span-1">
                            <span class="text-sm font-medium text-gray-700">æ˜æ—¥é ç´„ç¸½æ•¸</span>
                            <input type="number" id="tomorrowAppointments" value="0" min="0" required class="mt-1 w-full p-3 border border-indigo-300 rounded-lg">
                        </label>
                        <label class="block">
                            <span class="text-xs font-medium text-gray-500">é ç´„-éä¿</span>
                            <input type="number" id="tomorrowApptsExpired" value="0" min="0" required class="mt-1 w-full p-3 border border-indigo-300 rounded-lg text-sm">
                        </label>
                        <label class="block">
                            <span class="text-xs font-medium text-gray-500">é ç´„-RSæš«å€Ÿ</span>
                            <input type="number" id="tomorrowApptsRSL" value="0" min="0" required class="mt-1 w-full p-3 border border-indigo-300 rounded-lg text-sm">
                        </label>
                        <label class="block">
                            <span class="text-xs font-medium text-gray-500">é ç´„-è©¦è½</span>
                            <input type="number" id="tomorrowApptsTrial" value="0" min="0" required class="mt-1 w-full p-3 border border-indigo-300 rounded-lg text-sm">
                        </label>
                    </div>

                    <!-- æ˜æ—¥ KPI -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">æ˜æ—¥ KPIï¼šè‡³å°‘å¤–æ’¥ (é€š)</span>
                            <input type="number" id="kpiCalls" value="0" min="0" required class="mt-1 w-full p-3 border border-indigo-300 rounded-lg">
                        </label>
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">æ˜æ—¥ KPIï¼šè©¦ç”¨ç›®æ¨™ (ä½)</span>
                            <input type="number" id="kpiTrials" value="0" min="0" required class="mt-1 w-full p-3 border border-indigo-300 rounded-lg">
                        </label>
                    </div>

                    <!-- æ˜æ—¥å¤–æ’¥åå–® -->
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">æ˜æ—¥å¤–æ’¥åå–® (è«‹åˆ—é»æˆ–æ›è¡Œ)</span>
                        <textarea id="callListTomorrow" rows="4" placeholder="è«‹è¼¸å…¥å¤–æ’¥åå–®ï¼Œæ¯äººä¸€è¡Œ" class="mt-1 w-full p-3 border border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </label>
                </div>
            </div>

            <!-- ç”ŸæˆæŒ‰éˆ• -->
            <button type="button" onclick="generateReport()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-blue-300">
                ğŸš€ ç”Ÿæˆå ±å‘Š
            </button>
        </form>

        <!-- å ±å‘Šè¼¸å‡ºå€ -->
        <div id="outputArea" class="mt-10 pt-6 border-t border-gray-200 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex justify-between items-center">
                å ±å‘Šå…§å®¹
                <button onclick="copyToClipboard()" id="copyBtn" class="bg-teal-500 hover:bg-teal-600 text-white text-sm font-medium py-1.5 px-3 rounded-lg transition duration-150">
                    ä¸€éµè¤‡è£½
                </button>
            </h2>
            <textarea id="reportOutput" rows="15" readonly class="w-full p-4 border-2 border-dashed border-teal-400 bg-teal-50 text-gray-800 rounded-xl font-mono text-sm resize-none"></textarea>
        </div>
    </div>

    <script>
        // ç¢ºä¿åœ¨è¼‰å…¥æ™‚è‡ªå‹•è¨­å®šä»Šå¤©çš„æ—¥æœŸ
        window.onload = function() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // æœˆä»½æ˜¯å¾ 0 é–‹å§‹
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById('reportDate').value = `${yyyy}-${mm}-${dd}`;
        };

        /**
         * ç²å–è¼¸å…¥æ¬„ä½çš„å€¼ï¼Œä¸¦å°‡æ•¸å­—æ¬„ä½è½‰æ›ç‚ºæ•´æ•¸ï¼Œç¢ºä¿ç‚ºéè² å€¼ã€‚
         * @param {string} id - è¼¸å…¥æ¬„ä½çš„ ID
         * @returns {string | number}
         */
        function getInputValue(id) {
            const element = document.getElementById(id);
            if (!element) return 0; // é¿å…æ‰¾ä¸åˆ°å…ƒç´ æ™‚å‡ºéŒ¯

            if (element.type === 'number') {
                // ç¢ºä¿æ•¸å€¼æ˜¯æ•´æ•¸ä¸”éè² 
                return Math.max(0, parseInt(element.value, 10) || 0);
            }
            return element.value.trim();
        }

        /**
         * ç”Ÿæˆå ±å‘Šæ–‡å­—ä¸¦é¡¯ç¤ºåœ¨è¼¸å‡ºå€
         */
        function generateReport() {
            // 1. å–å¾—æ‰€æœ‰è¼¸å…¥å€¼
            const date = getInputValue('reportDate');
            const name = getInputValue('userName');

            const callsPotential = getInputValue('callsPotential');
            const callsExpired = getInputValue('callsExpired');
            
            const appointmentsToday = getInputValue('appointmentsToday');
            const storeVisitsTotal = getInputValue('storeVisitsTotal');
            const visitsExpired = getInputValue('visitsExpired');
            const visitsInWarranty = getInputValue('visitsInWarranty');
            const visitsNewCustomer = getInputValue('visitsNewCustomer');
            
            const trialHA = getInputValue('trialHA');
            const trialAPAP = getInputValue('trialAPAP');
            const dealHA = getInputValue('dealHA');
            const dealAPAP = getInputValue('dealAPAP');
            
            const monthlyTarget = getInputValue('monthlyTarget');
            const monthlyCumulative = getInputValue('monthlyCumulative');
            
            const tomorrowAppointments = getInputValue('tomorrowAppointments');
            const tomorrowApptsExpired = getInputValue('tomorrowApptsExpired');
            const tomorrowApptsRSL = getInputValue('tomorrowApptsRSL');
            const tomorrowApptsTrial = getInputValue('tomorrowApptsTrial');
            
            const kpiCalls = getInputValue('kpiCalls');
            const kpiTrials = getInputValue('kpiTrials');
            
            const callListTomorrow = getInputValue('callListTomorrow');

            // 2. é€²è¡Œè¨ˆç®—
            const monthlyMissing = Math.max(0, monthlyTarget - monthlyCumulative);

            // 3. æª¢æŸ¥æ—¥æœŸæ ¼å¼ (ç°¡å–®æª¢æŸ¥ï¼Œç¢ºä¿æ˜¯ YYYY-MM-DD æ ¼å¼)
            let formattedDate = date;
            if (date && date.match(/^\d{4}-\d{2}-\d{2}$/)) {
                // å¦‚æœæ˜¯æ¨™æº–æ—¥æœŸæ ¼å¼ï¼Œå°±ç›´æ¥ä½¿ç”¨
            } else {
                // å¦å‰‡ï¼Œæé†’æˆ–ä½¿ç”¨é è¨­å€¼
                formattedDate = 'æœªè¼¸å…¥æ—¥æœŸ';
            }

            // 4. çµ„åˆæˆè¦æ±‚çš„æ–‡å­—æ ¼å¼
            const reportText = `ã€${formattedDate}ï½œå§“åï¼š${name}ã€‘
ä»Šæ—¥å¤–æ’¥ï¼šæ½›å®¢${callsPotential}é€š + éä¿${callsExpired}é€š
ä»Šæ—¥é ç´„ï¼š ${appointmentsToday}ä½
ä»Šæ—¥åˆ°åº—ï¼š ${storeVisitsTotal}ä½ (${visitsExpired}ä½éä¿ã€${visitsInWarranty}ä½ä¿å…§ã€${visitsNewCustomer}ä½æ–°å®¢)
ã€€è©¦ç”¨ï¼šHA ${trialHA}ãƒ»APAP ${trialAPAP}
ã€€æˆäº¤ï¼šHA ${dealHA}ãƒ»APAP ${dealAPAP}
ç•¶æœˆè©¦è½é€²åº¦ï¼š
ğŸ‘‰ ç›®æ¨™${monthlyTarget}ä½ï½œç›®å‰ç´¯è¨ˆ${monthlyCumulative}ä½ï½œæœ¬æœˆå°šç¼º${monthlyMissing}ä½
æ˜æ—¥å·²æ’é ç´„ï¼š ${tomorrowAppointments}ä½(${tomorrowApptsExpired}ä½éä¿ã€${tomorrowApptsRSL}ä½RSæš«å€Ÿã€${tomorrowApptsTrial}ä½è©¦è½ï¼‰
æ˜æ—¥ KPIï¼š è‡³å°‘${kpiCalls}é€šå¤–æ’¥ + ${kpiTrials}ä½è©¦ç”¨
æ˜æ—¥å¤–æ’¥åå–®ï¼š${callListTomorrow}`;

            // 5. é¡¯ç¤ºçµæœ
            document.getElementById('reportOutput').value = reportText;
            document.getElementById('outputArea').classList.remove('hidden');

            // æ»¾å‹•åˆ°è¼¸å‡ºå€ï¼Œæ–¹ä¾¿ç”¨æˆ¶æŸ¥çœ‹å’Œè¤‡è£½
            document.getElementById('outputArea').scrollIntoView({ behavior: 'smooth' });
        }

        /**
         * è¤‡è£½å ±å‘Šæ–‡å­—åˆ°å‰ªè²¼ç°¿
         */
        function copyToClipboard() {
            const copyText = document.getElementById("reportOutput");
            copyText.select();
            copyText.setSelectionRange(0, 99999); // For mobile devices

            // ç”±æ–¼ navigator.clipboard åœ¨ iframe ä¸­å¯èƒ½æœ‰æ¬Šé™å•é¡Œï¼Œä½¿ç”¨ execCommand ä½œç‚ºå‚™ç”¨
            try {
                const successful = document.execCommand('copy');
                const copyBtn = document.getElementById('copyBtn');
                
                if (successful) {
                    const originalText = copyBtn.textContent;
                    copyBtn.textContent = 'âœ… å·²è¤‡è£½ï¼';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-teal-500');
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.add('bg-teal-500');
                        copyBtn.classList.remove('bg-green-600');
                    }, 1500);
                } else {
                    console.error('Fallback: document.execCommand("copy") failed.');
                }
            } catch (err) {
                console.error('ç„¡æ³•è¤‡è£½æ–‡å­—: ', err);
                // å¯ä»¥å½ˆå‡ºä¸€å€‹æç¤ºæ¡†è®“ç”¨æˆ¶æ‰‹å‹•è¤‡è£½
            }
        }
    </script>
</body>
</html>