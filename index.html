<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥æ¥­ç¸¾å ±å‘Šç”Ÿæˆå™¨ - è¨˜æ†¶å¢å¼·ç‰ˆ</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        :root {
            --cny-red: #d92b2b;
            --cny-gold: #f59e0b;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Microsoft JhengHei", sans-serif;
            background-color: #7f1d1d; /* æ·±ç´…åº•è‰² */
            background-image: 
                radial-gradient(circle at 2px 2px, rgba(245, 158, 11, 0.15) 1px, transparent 0);
            background-size: 32px 32px;
            overflow-x: hidden;
        }

        /* ç´…åŒ…å‹•ç•«æ¨£å¼ */
        .hongbao {
            position: fixed;
            top: -50px;
            font-size: 24px;
            user-select: none;
            pointer-events: none;
            z-index: 50;
            animation: fall linear forwards;
        }

        @keyframes fall {
            to {
                transform: translateY(105vh) rotate(360deg);
            }
        }

        input, textarea {
            appearance: none;
            -webkit-appearance: none;
            border-radius: 8px;
            font-size: 16px !important;
        }

        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .container-box {
            width: 100%;
            max-width: 100%;
        }

        /* è¨˜æ†¶å›é¡§å½ˆçª—å‹•ç•« */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .history-card {
            animation: slideIn 0.4s ease-out;
        }
    </style>
</head>
<body class="p-2 sm:p-4 md:p-8">

    <!-- ç´…åŒ…å®¹å™¨ -->
    <div id="hongbaoContainer"></div>

    <!-- æ­·å²å›é¡§å°è¦–çª— (é è¨­éš±è—) -->
    <div id="historyPopup" class="fixed top-4 right-4 z-[100] w-72 bg-white border-2 border-amber-400 rounded-xl shadow-2xl p-4 hidden history-card">
        <div class="flex justify-between items-start mb-2">
            <h4 class="font-bold text-red-700 text-sm">ğŸ“… ä¸Šæ¬¡é€²åº¦å›é¡§</h4>
            <button onclick="document.getElementById('historyPopup').classList.add('hidden')" class="text-gray-400 hover:text-red-500">âœ•</button>
        </div>
        <div id="historyContent" class="text-xs space-y-1 text-gray-700">
            <!-- å‹•æ…‹æ³¨å…¥å…§å®¹ -->
        </div>
        <button onclick="applyHistory()" class="w-full mt-3 bg-amber-100 hover:bg-amber-200 text-amber-800 text-[10px] py-1 rounded font-bold transition-colors">
            å¸¶å…¥éƒ¨åˆ†ç´¯è¨ˆæ•¸æ“š
        </button>
    </div>

    <div class="max-w-4xl mx-auto bg-white/95 shadow-2xl rounded-2xl p-4 sm:p-6 md:p-10 border-4 border-amber-400 relative overflow-hidden container-box">
        
        <div class="absolute -top-10 -right-10 w-40 h-40 bg-red-100 rounded-full opacity-50"></div>
        <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-red-100 rounded-full opacity-50"></div>
        
        <header class="relative z-10 mb-8">
            <h1 class="text-2xl sm:text-3xl font-black text-red-700 text-center flex flex-col sm:flex-row justify-center items-center gap-1">
                <span>ğŸ® å°åŒ—ä¸‰å€ ğŸ®</span>
                <span>æ¯æ—¥é€Ÿé€Ÿå›å ±</span>
            </h1>
            <div class="mt-2 h-1 w-24 bg-amber-500 mx-auto rounded-full"></div>
            <p class="text-amber-700 mt-4 text-center text-sm sm:text-base font-bold italic">
                ğŸ§§ ç¥¥é¾ç»ç‘ â€§ æ¥­ç¸¾é•·ç´… â€§ é–‹å·¥å¤§å‰ ğŸ§§
            </p>
        </header>

        <form id="reportForm" class="space-y-6 relative z-10">

            <!-- åŸºç¤è³‡è¨Š -->
            <section class="p-4 bg-red-50 rounded-xl border border-red-200 shadow-sm">
                <h2 class="text-md sm:text-lg font-bold text-red-800 mb-4 flex items-center gap-2">
                    <span class="bg-red-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span>
                    åŸºæœ¬è³‡è¨Šå›å ±
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-red-900 mb-1 uppercase">å›å ±æ—¥æœŸ</label>
                        <input type="date" id="reportDate" required class="w-full p-3 border border-red-200 rounded-lg bg-white focus:ring-2 focus:ring-red-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-red-900 mb-1">åŒä»å§“å</label>
                        <input type="text" id="userName" placeholder="è¼¸å…¥å§“å (è‡ªå‹•æœå°‹ç´€éŒ„)" required class="w-full p-3 border border-red-200 rounded-lg bg-white focus:ring-2 focus:ring-red-500 outline-none">
                    </div>
                </div>
            </section>

            <!-- å¤–æ’¥æ•¸æ“š -->
            <section class="p-4 bg-amber-50 rounded-xl border border-amber-200 shadow-sm">
                <h2 class="text-md sm:text-lg font-bold text-amber-900 mb-4 flex items-center gap-2">
                    <span class="bg-amber-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">2</span>
                    ä»Šæ—¥å¤–æ’¥æˆæ•ˆ
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white/80 p-3 rounded-lg border border-amber-100">
                        <p class="text-xs font-bold text-amber-800 mb-3 border-b border-amber-100 pb-1">æ–°å®¢ (Potential)</p>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="callsNew" placeholder="å¤–æ’¥é€šæ•¸" class="w-full p-2 border border-amber-200 rounded text-sm">
                            <input type="number" id="callsNewInvited" placeholder="æˆåŠŸé‚€ç´„" class="w-full p-2 border border-amber-200 rounded text-sm">
                        </div>
                    </div>
                    <div class="bg-white/80 p-3 rounded-lg border border-amber-100">
                        <p class="text-xs font-bold text-amber-800 mb-3 border-b border-amber-100 pb-1">èˆŠå®¢ (Existing)</p>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="callsOld" placeholder="å¤–æ’¥é€šæ•¸" class="w-full p-2 border border-amber-200 rounded text-sm">
                            <input type="number" id="callsOldInvited" placeholder="æˆåŠŸé‚€ç´„" class="w-full p-2 border border-amber-200 rounded text-sm">
                        </div>
                    </div>
                </div>
            </section>

            <!-- åˆ°åº—æ¦‚æ³ -->
            <section class="p-4 bg-emerald-50 rounded-xl border border-emerald-200 shadow-sm">
                <h2 class="text-md sm:text-lg font-bold text-emerald-900 mb-4 flex items-center gap-2">
                    <span class="bg-emerald-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">3</span>
                    ä»Šæ—¥åˆ°åº—æ´»å‹•
                </h2>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="col-span-1">
                        <label class="block text-[10px] font-bold text-emerald-800 mb-1">ä»Šæ—¥é ç´„ç¸½æ•¸</label>
                        <input type="number" id="appointmentsToday" placeholder="0" class="w-full p-3 border border-emerald-200 rounded-lg">
                    </div>
                    <div class="col-span-1">
                        <label class="block text-[10px] font-bold text-emerald-800 mb-1">åˆ°åº—ç¸½äººæ•¸</label>
                        <input type="number" id="storeVisitsTotal" placeholder="0" class="w-full p-3 border border-emerald-200 rounded-lg">
                    </div>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-5 gap-2 pt-2 border-t border-emerald-100">
                    <div class="flex flex-col"><span class="text-[10px] text-gray-500">HAæ–°å®¢</span><input type="number" id="visitsHA_New" class="p-2 border border-emerald-200 rounded text-xs"></div>
                    <div class="flex flex-col"><span class="text-[10px] text-gray-500">HAéä¿</span><input type="number" id="visitsHA_Expired" class="p-2 border border-emerald-200 rounded text-xs"></div>
                    <div class="flex flex-col"><span class="text-[10px] text-gray-500">HAä¿å…§</span><input type="number" id="visitsHA_InWarranty" class="p-2 border border-emerald-200 rounded text-xs"></div>
                    <div class="flex flex-col"><span class="text-[10px] text-gray-500">RSç”¨æˆ¶</span><input type="number" id="visitsRS" class="p-2 border border-emerald-200 rounded text-xs"></div>
                    <div class="flex flex-col"><span class="text-[10px] text-gray-500">å…¶ä»–</span><input type="number" id="visitsOther" class="p-2 border border-emerald-200 rounded text-xs"></div>
                </div>
            </section>

            <!-- æˆæœ -->
            <section class="p-4 bg-rose-50 rounded-xl border border-rose-200 shadow-sm">
                <h2 class="text-md sm:text-lg font-bold text-rose-900 mb-4 flex items-center gap-2">
                    <span class="bg-rose-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">4</span>
                    è©¦ç”¨èˆ‡æˆäº¤
                </h2>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                    <input type="number" id="trialHA" placeholder="è©¦ç”¨ HA" class="p-3 border border-rose-200 rounded-lg text-sm">
                    <input type="number" id="trialAPAP" placeholder="è©¦ç”¨ APAP" class="p-3 border border-rose-200 rounded-lg text-sm">
                    <input type="number" id="dealHA" placeholder="æˆäº¤ HA" class="p-3 border border-rose-200 rounded-lg text-sm">
                    <input type="number" id="dealAPAP" placeholder="æˆäº¤ APAP" class="p-3 border border-rose-200 rounded-lg text-sm">
                </div>
                <div class="mt-4">
                    <label class="block text-xs font-bold text-rose-800 mb-1">ä»Šæ—¥æˆäº¤ç¸½é‡‘é¡ (è¬)</label>
                    <input type="number" id="dealTotalRevenue" placeholder="ç™¼ç™¼ç™¼" step="0.1" class="w-full p-3 border-2 border-rose-400 rounded-lg bg-white font-bold text-rose-700">
                </div>
            </section>

            <!-- é€²åº¦ -->
            <section class="p-4 bg-purple-50 rounded-xl border border-purple-200 shadow-sm">
                <h2 class="text-md sm:text-lg font-bold text-purple-900 mb-4 flex items-center gap-2">
                    <span class="bg-purple-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">5</span>
                    ç•¶æœˆè©¦è½ç›®æ¨™
                </h2>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <input type="number" id="monthlyTarget" placeholder="æœ¬æœˆç›®æ¨™" class="p-3 border border-purple-200 rounded-lg text-sm">
                    <input type="number" id="monthlyCumulative" placeholder="ç›®å‰ç´¯è¨ˆ" class="p-3 border border-purple-200 rounded-lg text-sm">
                </div>
                <details class="bg-white/60 rounded-lg overflow-hidden border border-purple-100">
                    <summary class="p-2 text-xs font-bold text-purple-700 cursor-pointer hover:bg-purple-100">é»æ­¤å±•é–‹åŒä»ç›®æ¨™åƒè€ƒåå–®</summary>
                    <div class="p-2 grid grid-cols-3 gap-1 text-[10px] leading-tight" id="refList">
                        <!-- åå–®ç•¥ -->
                        <div class="flex justify-between border-b p-1"><span>è¨±æ‡¿èŠ¬</span><b>6</b></div>
                        <div class="flex justify-between border-b p-1"><span>å³ç¢©ä¿®</span><b>9</b></div>
                        <div class="flex justify-between border-b p-1"><span>è”¡äºæ¬£</span><b>14</b></div>
                        <div class="flex justify-between border-b p-1"><span>éƒ­ç‘‹</span><b>18</b></div>
                        <div class="flex justify-between border-b p-1"><span>æ—åŠ­æ©</span><b>10</b></div>
                        <div class="flex justify-between border-b p-1"><span>é¡§ç¿ è¯</span><b>6</b></div>
                        <div class="flex justify-between border-b p-1"><span>æ±Ÿæµ©èª </span><b>8</b></div>
                        <div class="flex justify-between border-b p-1"><span>é»ƒéˆ´éˆ</span><b>7</b></div>
                        <div class="flex justify-between border-b p-1"><span>è¨±å¦‚æ±¶</span><b>6</b></div>
                        <div class="flex justify-between border-b p-1"><span>è‘‰æ·³å¦¤</span><b>5</b></div>
                        <div class="flex justify-between border-b p-1"><span>è©¹å©·å©·</span><b>6</b></div>
                        <div class="flex justify-between border-b p-1"><span>åŠ‰å‰çˆ¾</span><b>6</b></div>
                        <div class="flex justify-between border-b p-1"><span>æ—æ¹˜ç­‘</span><b>6</b></div>
                        <div class="flex justify-between border-b p-1"><span>é™³ç¥ç’‡</span><b>5</b></div>
                    </div>
                </details>
            </section>

            <!-- æ˜æ—¥è¨ˆç•« -->
            <section class="p-4 bg-orange-50 rounded-xl border border-orange-200 shadow-sm">
                <h2 class="text-md sm:text-lg font-bold text-orange-900 mb-4 flex items-center gap-2">
                    <span class="bg-orange-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">6</span>
                    æ˜æ—¥æˆ°é¬¥è¨ˆç•«
                </h2>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4">
                    <div class="flex flex-col"><span class="text-[10px] text-gray-500">é ç´„ç¸½æ•¸</span><input type="number" id="tomorrowAppointments" class="p-2 border rounded"></div>
                    <div class="flex flex-col"><span class="text-[10px] text-gray-500">é ç´„-éä¿</span><input type="number" id="tomorrowApptsExpired" class="p-2 border rounded"></div>
                    <div class="flex flex-col"><span class="text-[10px] text-gray-500">RSæš«å€Ÿ</span><input type="number" id="tomorrowApptsRSL" class="p-2 border rounded"></div>
                    <div class="flex flex-col"><span class="text-[10px] text-gray-500">é ç´„-è©¦è½</span><input type="number" id="tomorrowApptsTrial" class="p-2 border rounded"></div>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-orange-800 mb-1">æ˜æ—¥é è¨ˆç”¢å‡ºé‡‘é¡ (è¬)</label>
                        <input type="number" id="tomorrowRevenue" placeholder="é è¨ˆæˆäº¤é¡" step="0.1" class="w-full p-3 border border-orange-200 rounded-lg">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] font-bold text-orange-800">æ˜æ—¥å¤–æ’¥ KPI</label>
                            <input type="number" id="kpiCalls" placeholder="é€šæ•¸" class="w-full p-3 border border-orange-200 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-orange-800">æ˜æ—¥è©¦ç”¨ç›®æ¨™</label>
                            <input type="number" id="kpiTrials" placeholder="ä½æ•¸" class="w-full p-3 border border-orange-200 rounded-lg">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-orange-800 mb-1">æ˜æ—¥å¤–æ’¥åå–®</label>
                        <textarea id="callListTomorrow" rows="3" placeholder="è«‹åˆ—é»åå–®" class="w-full p-3 border border-orange-200 rounded-lg text-sm resize-none"></textarea>
                    </div>
                </div>
            </section>

            <div class="pt-4">
                <button type="button" onclick="generateReport()" class="w-full bg-red-600 hover:bg-red-700 text-yellow-100 font-black py-5 px-4 rounded-2xl shadow-xl transition-all active:scale-95 border-b-8 border-red-800 text-xl flex items-center justify-center gap-3">
                    ğŸ§¨ ç”Ÿæˆé–‹é‹å ±å‘Š ğŸ§¨
                </button>
            </div>
        </form>

        <div id="outputArea" class="mt-10 pt-6 border-t-4 border-red-100 hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-red-800">ğŸ“œ å›å ±å…§å®¹</h3>
                <button onclick="copyToClipboard()" id="copyBtn" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-6 rounded-full shadow-md text-sm transition-colors">
                    é»æ­¤è¤‡è£½
                </button>
            </div>
            <textarea id="reportOutput" rows="18" readonly class="w-full p-5 border-2 border-dashed border-red-300 bg-red-50/50 text-gray-800 rounded-2xl font-mono text-xs leading-relaxed focus:outline-none"></textarea>
        </div>
        
        <footer class="mt-8 text-center text-[10px] text-gray-400">
            Â© 2025 å°åŒ—ä¸‰å€æ¥­ç¸¾é•·ç´…ç”Ÿæˆå™¨
        </footer>
    </div>

    <script>
        let lastUserData = null;

        // åˆå§‹åŒ–
        window.onload = () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reportDate').value = today;

            // ç›£è½å§“åè¼¸å…¥
            document.getElementById('userName').addEventListener('input', function(e) {
                checkHistory(e.target.value);
            });
        };

        // æª¢æŸ¥æ­·å²ç´€éŒ„
        function checkHistory(name) {
            if (!name || name.trim() === '') {
                document.getElementById('historyPopup').classList.add('hidden');
                return;
            }

            const history = JSON.parse(localStorage.getItem('tp3_report_history') || '{}');
            const data = history[name.trim()];

            if (data) {
                lastUserData = data;
                const popup = document.getElementById('historyPopup');
                const content = document.getElementById('historyContent');
                
                popup.classList.remove('hidden');
                content.innerHTML = `
                    <p><b>ä¸Šæ¬¡å›å ±ï¼š</b>${data.date || 'ç„¡'}</p>
                    <p><b>ä¸Šæ¬¡è¨ˆç•«é‡‘é¡ï¼š</b><span class="text-red-600 font-bold">${data.tomorrowRevenue || 0} è¬</span></p>
                    <p><b>é ç´„æ•¸ï¼š</b>${data.tomorrowAppointments || 0} ä½</p>
                    <p><b>ä¸Šæ¬¡è¨ˆç•«åå–®ï¼š</b><br><span class="text-blue-600">${(data.callListTomorrow || 'ç„¡').substring(0, 30)}...</span></p>
                    <p class="mt-2 text-[10px] text-gray-400">ğŸ’¡ ç•¶å‰ç´¯è¨ˆ: ${data.monthlyCumulative || 0}</p>
                `;
            } else {
                document.getElementById('historyPopup').classList.add('hidden');
            }
        }

        // å¸¶å…¥æ­·å²æ•¸æ“š
        function applyHistory() {
            if (lastUserData) {
                // è‡ªå‹•å¸¶å…¥ã€Œæœˆç´¯è¨ˆã€èˆ‡ã€Œæœˆç›®æ¨™ã€ä»¥ç¯€çœæ™‚é–“
                document.getElementById('monthlyTarget').value = lastUserData.monthlyTarget || '';
                document.getElementById('monthlyCumulative').value = lastUserData.monthlyCumulative || '';
                
                // è¦–è¦ºæç¤º
                const msg = document.createElement('div');
                msg.className = "fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 text-white px-4 py-2 rounded-lg z-[200]";
                msg.innerText = "å·²å¸¶å…¥é€²åº¦æ•¸æ“š";
                document.body.appendChild(msg);
                setTimeout(() => msg.remove(), 1500);
            }
        }

        function spawnHongbao() {
            const container = document.getElementById('hongbaoContainer');
            const icons = ['ğŸ§§', 'ğŸ§§', 'ğŸ§§', 'âœ¨', 'ğŸ®', 'ğŸŠ'];
            const count = 30;

            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const hb = document.createElement('div');
                    hb.className = 'hongbao';
                    hb.innerText = icons[Math.floor(Math.random() * icons.length)];
                    hb.style.left = Math.random() * 100 + 'vw';
                    hb.style.animationDuration = (Math.random() * 2 + 3) + 's';
                    hb.style.opacity = Math.random();
                    container.appendChild(hb);
                    setTimeout(() => hb.remove(), 5000);
                }, i * 100);
            }
        }

        function getVal(id) {
            const el = document.getElementById(id);
            return el ? (el.value || '0') : '0';
        }

        function generateReport() {
            spawnHongbao();

            const dateStr = getVal('reportDate');
            const name = document.getElementById('userName').value;
            const dateObj = new Date(dateStr);
            const formattedDate = isNaN(dateObj) ? dateStr : `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;

            // æ”¶é›†æ•¸æ“š
            const formData = {
                date: dateStr,
                userName: name,
                callsNew: getVal('callsNew'),
                callsNewInvited: getVal('callsNewInvited'),
                callsOld: getVal('callsOld'),
                callsOldInvited: getVal('callsOldInvited'),
                appointmentsToday: getVal('appointmentsToday'),
                storeVisitsTotal: getVal('storeVisitsTotal'),
                visitsHA_New: getVal('visitsHA_New'),
                visitsHA_Expired: getVal('visitsHA_Expired'),
                visitsHA_InWarranty: getVal('visitsHA_InWarranty'),
                visitsRS: getVal('visitsRS'),
                visitsOther: getVal('visitsOther'),
                trialHA: getVal('trialHA'),
                trialAPAP: getVal('trialAPAP'),
                dealHA: getVal('dealHA'),
                dealAPAP: getVal('dealAPAP'),
                dealTotalRevenue: getVal('dealTotalRevenue'),
                monthlyTarget: getVal('monthlyTarget'),
                monthlyCumulative: getVal('monthlyCumulative'),
                tomorrowAppointments: getVal('tomorrowAppointments'),
                tomorrowApptsExpired: getVal('tomorrowApptsExpired'),
                tomorrowApptsRSL: getVal('tomorrowApptsRSL'),
                tomorrowApptsTrial: getVal('tomorrowApptsTrial'),
                tomorrowRevenue: getVal('tomorrowRevenue'),
                kpiCalls: getVal('kpiCalls'),
                kpiTrials: getVal('kpiTrials'),
                callListTomorrow: document.getElementById('callListTomorrow').value
            };

            // å„²å­˜åˆ°è¨˜æ†¶é«”
            if (name.trim() !== "") {
                const history = JSON.parse(localStorage.getItem('tp3_report_history') || '{}');
                history[name.trim()] = formData;
                localStorage.setItem('tp3_report_history', JSON.stringify(history));
            }

            // ç”Ÿæˆå ±å‘Šæ–‡å­—
            const mTar = parseInt(formData.monthlyTarget) || 0;
            const mCum = parseInt(formData.monthlyCumulative) || 0;
            const mMis = Math.max(0, mTar - mCum);

            const report = `ã€${formattedDate}ï½œå§“åï¼š${name}ã€‘
ä»Šæ—¥å¤–æ’¥ï¼šæ–°å®¢ ${formData.callsNew} é€š (é‚€ç´„ ${formData.callsNewInvited} ä½) | èˆŠå®¢ ${formData.callsOld} é€š (é‚€ç´„ ${formData.callsOldInvited} ä½)
ä»Šæ—¥é ç´„ï¼š${formData.appointmentsToday} ä½
ä»Šæ—¥åˆ°åº—ï¼š${formData.storeVisitsTotal} ä½ (${formData.visitsHA_New}ä½HAæ–°å®¢ã€${formData.visitsHA_Expired}ä½HAéä¿ã€${formData.visitsHA_InWarranty}ä½HAä¿å…§ã€${formData.visitsRS}ä½RSã€${formData.visitsOther}ä½å…¶ä»–)
ã€€è©¦ç”¨ï¼šHA ${formData.trialHA} ä½ ãƒ»APAP ${formData.trialAPAP} ä½
ã€€æˆäº¤ï¼šHA ${formData.dealHA} ä½ ãƒ»APAP ${formData.dealAPAP} ä½ (é‡‘é¡ ${formData.dealTotalRevenue} è¬)

ç•¶æœˆè©¦è½é€²åº¦ï¼š
ğŸ‘‰ ç›®æ¨™ ${mTar} ä½ï½œç´¯è¨ˆ ${mCum} ä½ï½œå°šç¼º ${mMis} ä½

æ˜æ—¥å·²æ’é ç´„ï¼š${formData.tomorrowAppointments} ä½ (${formData.tomorrowApptsExpired}éä¿ã€${formData.tomorrowApptsRSL}RSæš«å€Ÿã€${formData.tomorrowApptsTrial}è©¦è½ï¼‰
æ˜æ—¥é è¨ˆç”¢å‡ºé‡‘é¡ï¼š${formData.tomorrowRevenue} è¬
æ˜æ—¥ KPIï¼šè‡³å°‘ ${formData.kpiCalls} é€šå¤–æ’¥ + ${formData.kpiTrials} ä½è©¦ç”¨
æ˜æ—¥å¤–æ’¥åå–®ï¼š
${formData.callListTomorrow || 'ç„¡'}`;

            const outputArea = document.getElementById('outputArea');
            const outputText = document.getElementById('reportOutput');
            outputArea.classList.remove('hidden');
            outputText.value = report;

            window.scrollTo({ top: outputArea.offsetTop, behavior: 'smooth' });
        }

        function copyToClipboard() {
            const ta = document.getElementById('reportOutput');
            const btn = document.getElementById('copyBtn');
            ta.select();
            document.execCommand('copy');
            
            const oldText = btn.textContent;
            btn.textContent = 'âœ… å·²è¤‡è£½ï¼';
            btn.classList.replace('bg-amber-500', 'bg-green-600');
            setTimeout(() => {
                btn.textContent = oldText;
                btn.classList.replace('bg-green-600', 'bg-amber-500');
            }, 2000);
        }
    </script>
</body>
</html>